AddConfigHandler MiscLaunchOptions
AddConfigHelp "OnSuspend NN <program to execute> [parameters for program]" "Executes a given program before suspending. NN is a number between 11 and 98, inclusive - a higher number means the program will be executed later in the suspend process."
AddConfigHelp "OnResume NN <program to execute> [parameters for program]" "Executes a given program after resuming. NN is a number between 11 and 98, inclusive - a higher number means the program will be executed earlier in the resume process."

MISC_LAUNCH_COUNT=0

MiscLaunchSuspendProg() {
    local tmpf
    MISC_LAUNCH_COUNT=$(($MISC_LAUNCH_COUNT+1))
    tmpf=`mktemp`
    AddSuspendHook $1 MiscLaunchAuxFunc$MISC_LAUNCH_COUNT
    shift
    cat <<EOT > $tmpf
MiscLaunchAuxFunc${MISC_LAUNCH_COUNT}() {
    vecho 1 "Executing $@..."
    $@
}
EOT
    . $tmpf
    rm -f $tmpf
}

MiscLaunchResumeProg() {
    local tmpf
    MISC_LAUNCH_COUNT=$(($MISC_LAUNCH_COUNT+1))
    tmpf=`mktemp`
    AddResumeHook $1 MiscLaunchAuxFunc$MISC_LAUNCH_COUNT
    shift
    cat <<EOT > $tmpf
MiscLaunchAuxFunc${MISC_LAUNCH_COUNT}() {
    vecho 1 "Executing $@..."
    $@
}
EOT
    . $tmpf
    rm -f $tmpf
}

MiscLaunchOptions() {
    case $1 in
	onsuspend)
	    shift
	    MiscLaunchSuspendProg $*
	    ;;
	onresume)
	    shift
	    MiscLaunchResumeProg $*
	    ;;
	*)
	    return 1
    esac
    return 0
}

# vim:ft=sh:ts=8:sw=4:noet
