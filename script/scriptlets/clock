AddConfigHandler ClockOptions
AddConfigHelp "SaveClock <boolean>" "Set this to yes to restore the system clock after a suspend."

ClockSave() {
	if ! /sbin/hwclock --systohc ; then
		echo "$EXE: Failed to save system clock - continuing anyway"
	fi
	return 0  # clock save failing shouldn't be a show stopper.
}

ClockRestore() {
	if ! /sbin/hwclock --hctosys ; then
		echo "$EXE: Failed to restore system clock."
	fi
	# exit code unchanged.
}

ClockOptions() {
	case $1 in
		saveclock)
			if [ -n "$2" ] && BoolIsOn "$1" "$2" ; then
				AddSuspendHook 99 ClockSave
				AddResumeHook 99 ClockRestore
			fi
			;;
		*)
			return 1
	esac
	return 0
}

# vim:ft=sh
