TITLE=Software Suspend HOWTO;LINUXDOC

 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.21">
 <TITLE>Software Suspend HOWTO: How it works</TITLE>
 <LINK HREF="Software-suspend-4.html" REL=previous>
 <LINK HREF="Software-suspend.html#toc5" REL=contents>
</HEAD>
<BODY>
Next
<A HREF="Software-suspend-4.html">Previous</A>
<A HREF="Software-suspend.html#toc5">Contents</A>
<HR>
<H2><A NAME="s5">5.</A> <A HREF="Software-suspend.html#toc5">How it works</A></H2>

<P> For the more curious users, briefly listed here are the steps of the kernel part
of the suspend process. This may also help in tracking why it doesn't suspend.</P>
<P>
<OL>
<LI> Stop all processes. If some processes can't be stopped, abort. </LI>
<LI> Eat memory. At this stage we check if we have enough memory to save the
image and meet your specifications for maximum image size. If necessary, we
unfreeze the processes, eat memory until we think we have enough and then try
again from step 1.</LI>
<LI> Suspend drivers. This accounts for the screen briefly going blank on
some computers.</LI>
<LI> Prepare a directory of pages and save it along with the image. This
is done in two parts. First, all of the pages we know aren't needed for
suspend (ie, not buffer &amp; page caches) are saved, being very careful not to have
a lasting impact on the image we're making. Then, an atomic copy is made
of the remaining pages (kernel &amp; process space) using the memory just
saved and any other free RAM. This copy is then saved. Finally, we save
the page directory for the latter set of pages separately and also store
the page directory's location in the swap header. We can then (if your
computer supports it) power down.</LI>
</OL>
</P>
<P>Resuming is essentially the reverse of this process. The pagedir is
loaded, as is the copy (being careful not to use RAM we're about to
overwrite). Then we copy the old kernel back and restore registers. We
are now running with the original kernel image. Finally, we load the
first set of pages we saved, clean up and exit.</P>

<HR>
Next
<A HREF="Software-suspend-4.html">Previous</A>
<A HREF="Software-suspend.html#toc5">Contents</A>
